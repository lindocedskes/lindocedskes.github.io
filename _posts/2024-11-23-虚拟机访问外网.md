---
title: 虚拟机访问外网和一般linux挂代理的方式
description: 主机windows+虚拟机ubuntu，通过主机的vpn访问外网。也适用于一般linux通过终端挂代理
author: #有默认值
date: 2024-11-23 10:13:14 +0800
categories:   [tools,vpn]
tags:  [linux, 挂代理]     # TAG names should always be lowercase
pin:  # 默认false，可填true
math: true
mermaid: true
# image:
#    path: /assets/bar/backimg.png
#    lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAA
#    alt:  # 图片名
---


## 前置信息

1. 获取主机上的代理软件运行的端口
![](../assets/img/2024-11/clash.png)

2. 虚拟机网络与主机是NAT方式
3. 查看主机ip `ipconfig` 选择VMware Network Adapter VMnet8 对应的ipv4.（虚拟机能ping到的）
![](../assets/img/2024-11/ip.png)

##  GUI 下配置
1. 打开右上角，选择Wired Connected 中的Wired Settings ，之后步骤见下图
![](./assets/img/2024-11/iShot_2024-11-23_16.29.15.png)


##  linux终端中配置 （已经安装好了代理）
> export仅对当前终端生效，可写入终端对应配置文件`~/.bashrc` 最后一行使永久生效.在linux 安装代理见 [另一篇文章](/posts/docker镜像源被封-Linux服务器挂代理和docker配置代理/)
{: .prompt-tip }
之前在Debian系统上指定代理的ip+端口，使用如下命令就可以了
```shell
export ALL_PROXY=http://127.0.0.1:7890
```
但在ubuntu22 LTS 中发现export ALL_PROXY后用wget 测试后不行，用下面可以。可能是因为 wget  默认不使用 ALL_PROXY 环境变量
```shell
export http_proxy=http://192.168.130.1:7897
export https_proxy=http://192.168.130.1:7897
```
> export XXX_proxy=http://ip:port ,上面的ip和端口都取决于代理程序运行在哪个主机上和对应端口
{: .prompt-warning }